<template>
  <div class="app">
    <div class="app__header">
      <div v-show="isBackVisible" @click="goBack" class="app__header__back">
        <svg viewBox="0 0 141 141" height="20" width="20" xmlns="http://www.w3.org/2000/svg">
          <path fill="white" d="M105.614 118.681c3.398 3.396 3.4 8.912 0 12.311-3.396 3.399-8.91 3.398-12.311 0-.02-.02-.035-.04-.053-.061l-.025.022-57.66-57.66.024-.022a8.664 8.664 0 01-2.608-6.208 8.672 8.672 0 013.229-6.762l-.06-.058 57.66-57.66.025.024c.018-.021.033-.039.053-.058A8.706 8.706 0 01106.2 14.86c-.021.02-.041.034-.061.054l.023.024-52.119 52.125 51.54 51.54-.025.021c.015.022.036.036.056.057"/>
        </svg>
      </div>
      <div class="app__header__title">r/soccer.live</div>
      <div class="app__header__logo">
        <svg width="30" height="37" viewBox="0 0 103 129" fill="none" xmlns="http://www.w3.org/2000/svg">
          <ellipse cx="48.0717" cy="80.4266" rx="48.0717" ry="48.0724" fill="white"/>
          <path d="M30.5628 34.5858C24.4841 37.0504 19.0296 40.6741 14.3525 45.35C9.67393 50.0272 6.05433 55.4831 3.58845 61.5605C1.20789 67.4321 0 73.6368 0 80.0014C0 86.3645 1.20789 92.5692 3.58845 98.4381C6.05433 104.517 9.67528 109.973 14.3525 114.649C19.0296 119.327 24.4827 122.948 30.5628 125.413C36.4343 127.796 42.6376 129 49.002 129C55.3665 129 61.5684 127.792 67.4399 125.413C73.5173 122.948 78.9744 119.327 83.6502 114.649C88.3288 109.973 91.9497 104.52 94.4142 98.4381C96.7948 92.5692 98 86.3645 98 80.0014C98 73.6368 96.7935 67.4321 94.4142 61.5605C91.9497 55.4831 88.3261 50.0258 83.6502 45.35C78.9744 40.6741 73.5227 37.0504 67.4399 34.5858C61.5684 32.2065 55.3665 31 49.002 31C42.6376 31 36.4343 32.2065 30.5628 34.5858ZM12.2468 100.629C9.88653 99.1477 7.71179 97.4415 5.78621 95.4319C2.84503 87.1553 2.34671 78.1949 4.29531 69.6895C5.21206 67.8817 6.25474 66.1457 7.43419 64.4828C7.79845 63.9695 8.13563 63.4347 8.52562 62.9363L19.5835 69.4796C19.5835 69.5663 19.5835 69.661 19.5835 69.7572C19.555 75.7046 20.159 81.6087 21.3615 87.4275C21.3655 87.4546 21.3696 87.4695 21.375 87.4939L12.7993 100.941C12.6124 100.846 12.4269 100.743 12.2468 100.629ZM45.1251 123.361C47.0331 124.335 48.9953 125.157 51.0116 125.826C42.4467 126.198 33.7965 124.191 26.1497 119.804L44.6864 123.107C44.8286 123.197 44.9735 123.284 45.1251 123.361ZM45.0574 120.015L23.1828 116.117C20.6235 113.009 18.3214 109.721 16.343 106.207C15.8393 105.313 15.2773 104.445 14.8508 103.512L23.4184 90.079C23.608 90.1263 23.8192 90.1765 24.0589 90.2401C29.4186 91.6741 34.873 92.6938 40.3654 93.4928C40.6863 93.5375 40.9544 93.5767 41.1833 93.6011L51.453 111.358C49.671 113.863 47.8686 116.355 46.027 118.819C45.721 119.23 45.396 119.624 45.0574 120.015ZM81.4511 112.451C79.7097 114.194 77.8613 115.765 75.9263 117.165C75.6053 114.6 75.0515 112.087 74.2702 109.632L85.2278 89.1893C88.2462 87.8148 91.1576 86.2562 93.8604 84.3238C94.2138 84.0733 94.5077 83.793 94.7352 83.4869C93.9417 94.0507 89.5136 104.39 81.4511 112.451ZM80.965 85.9393C81.3726 86.7166 81.7748 87.502 82.1783 88.2982L71.5944 108.042C71.5335 108.055 71.4752 108.069 71.4143 108.077C65.6931 109.145 59.9258 109.714 54.1098 109.741L43.5476 91.4778C45.1915 88.4255 46.8205 85.3611 48.436 82.2953C49.5329 80.2153 50.6107 78.1218 51.6873 76.0296L73.5471 73.7844C76.2242 77.7115 78.7605 81.7225 80.965 85.9393ZM76.5302 62.5206C75.4929 65.2601 74.3826 67.9711 73.2789 70.6875L51.9838 72.8744C51.7293 72.5386 51.4652 72.2082 51.1876 71.8927C48.673 69.0449 46.1421 66.2147 43.6153 63.3764C43.6383 63.348 43.6613 63.3263 43.6843 63.3006C42.6647 62.2823 41.6423 61.2639 40.6227 60.2429L46.551 42.3938C46.96 42.2855 47.3717 42.1948 47.7874 42.1501C51.0102 41.8224 54.2371 41.4513 57.4681 41.2645C59.4465 41.1534 61.4357 41.0898 63.4479 41.232L78.1159 57.7648C77.6108 59.36 77.1179 60.9593 76.5302 62.5206ZM81.4511 47.5491C85.4973 51.598 88.6307 56.2184 90.8461 61.1543C88.1053 59.2679 85.175 57.7161 82.0943 56.4513C81.615 56.2536 81.1234 56.0789 80.6238 55.9069L66.186 39.6341C66.2862 38.9313 66.339 38.2271 66.3607 37.5175C71.853 39.7532 77.0014 43.1007 81.4511 47.5491ZM34.3056 36.6631C34.3625 36.705 34.3896 36.7403 34.4221 36.7497C37.7221 37.8899 40.7242 39.5691 43.5544 41.561L38.0159 58.2401C37.9875 58.2482 37.9604 58.2564 37.9333 58.2686C36.7999 58.7371 35.6449 59.1569 34.5291 59.6647C29.9318 61.7541 25.4496 64.0684 21.2274 66.8431L10.2982 60.377C10.3144 60.0357 10.3727 59.6891 10.4891 59.3803C11.2231 57.4249 11.9448 55.4587 12.7749 53.5426C13.414 52.0665 14.1426 50.6406 14.9374 49.2472C15.4574 48.673 15.9964 48.1043 16.5516 47.5491C21.742 42.36 27.8762 38.6753 34.4072 36.4965C34.3733 36.5493 34.3381 36.6048 34.3056 36.6631Z" fill="black"/>
          <line x1="46.6985" y1="36.0236" x2="60.6985" y2="3.02362" stroke="black" stroke-width="5"/>
          <line x1="58.0618" y1="3.0193" x2="83.6402" y2="12.2793" stroke="black" stroke-width="5"/>
          <circle class="blinking" cx="89.5" cy="14.5" r="13.5" fill="#FF0000"/>
        </svg>
      </div>
      <div class="app__header__new-highlights" v-show="getNewHighlightIds.length > 0" @click="addNewHighlights">
        <svg class="app__header__new-highlights__refresh-icon" viewBox="0 0 512 512" width="20" height="20" xmlns="http://www.w3.org/2000/svg">
          <path fill="white" d="M61.496 279.61C60.508 271.374 60 263.194 60 256c0-107.402 88.598-196 196-196 50.098 0 97 20.2 131.5 51.7l-17.3 17.6c-3.9 3.9-5.4 9.598-3.9 15 1.802 5.098 6 9 11.4 10.2 3.019.605 102.214 32.57 95.898 31.3 8.035 2.677 19.918-5.894 17.703-17.698-.61-3.024-22.57-113.215-21.301-106.903-1.2-5.398-5.102-9.898-10.5-11.398-5.098-1.5-10.8 0-14.7 3.898l-14.698 14.399C384.8 25.8 322.598 0 256 0 115.3 0 0 115.3 0 256v.598c0 8.457.387 14.992.836 19.992a14.999 14.999 0 0012.004 13.36l30.816 6.16c10.032 2.007 19.051-6.403 17.84-16.5zm0 0M499.25 222.027l-30.906-6.297c-10.043-2.046-19.125 6.372-17.89 16.516C451.523 241 452 249.512 452 256c0 107.398-88.598 196-196 196-50.098 0-97-20.2-131.5-52l17.3-17.3c3.9-3.9 5.4-9.598 3.9-15-1.802-5.102-6-9-11.4-10.2-3.019-.61-102.214-32.57-95.898-31.3-5.101-.9-10.203.6-13.5 4.198-3.601 3.301-5.101 8.7-4.203 13.5.61 3.02 22.574 112.211 21.305 105.899 1.195 5.402 5.098 9.902 10.496 11.398 6.262 1.57 11.488-.328 14.7-3.898l14.402-14.399C126.898 485.2 189.102 512 256 512c140.7 0 256-115.3 256-256v-.902c0-6.649-.242-13.176-.797-19.664a14.994 14.994 0 00-11.953-13.407zm0 0"/>
        </svg>
        <span>{{ getNewHighlightIds.length }} new highlights</span>
      </div>
    </div>
    <div class="app__content">
      <router-view />
    </div>
  </div>
</template>


<script>
import { mapActions, mapGetters } from 'vuex'
import WebSocketClient from './websocket_client.js'

export default {
  computed: {
    ...mapGetters(['getNewHighlightIds']),
    isBackVisible () {
      return this.$route.name === 'highlight'
    },
  },
  methods: {
    ...mapActions(['addWebSocketEvent', 'addNewHighlights']),
    goBack () {
      if (window.history.length > 2) {
        this.$router.go(-1)
      } else {
        this.$router.push({ name: 'highlights' })
      }
    },
  },
  mounted () {
    new WebSocketClient(process.env.VUE_APP_RSOCCERLIVE_WS_URL, this.addWebSocketEvent)
  },
}
</script>

<style scoped lang="less">
.app {
  &__content {
    padding: 0 16px;
  }

  &__header {
    position: sticky;
    top: 0;
    padding: 16px;
    z-index: 9999;
    display: flex;
    background-color: #31a05f;
    color: white;

    &__back {
      display: flex;
      align-items: center;
      margin-right: 16px;
      cursor: pointer;
    }

    &__title {
      font-size: 32px;
      margin-right: 8px;
    }

    &__new-highlights {
      display: flex;
      align-items: center;
      margin-left: 16px;
      cursor: pointer;
      padding: 4px 8px;
      border-radius: 5px;
      background-color: black;
      color: white;

      &__refresh-icon {
        margin-right: 8px;
      }
    }
  }

}
</style>

<style lang="less">
html, body {
  background-color: #31a05f;
  padding: 0;
  margin: 0;
  font-family: BlinkMacSystemFont, -apple-system, Segoe UI, Roboto, Oxygen, Ubuntu, Cantarell, Fira Sans, Droid Sans, Helvetica Neue, Helvetica, Arial, sans-serif;
}
</style>
